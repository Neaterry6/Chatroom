
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>StreamMe Chatroom</title>
<style>
  /* Basic reset */
  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    transition: background-color 0.3s ease, color 0.3s ease;
    overflow: hidden;
  }

  /* Theme variables */
  :root {
    --bg-color: #0a0a0a;
    --text-color: #fff;
    --nav-bg: #111;
    --input-bg: #222;
    --msg-bg: #1a1a1a;
    --btn-bg: #3498db;
  }

  body.light-mode {
    --bg-color: #f5f5f5;
    --text-color: #222;
    --nav-bg: #ddd;
    --input-bg: #fff;
    --msg-bg: #eee;
    --btn-bg: #3498db;
  }

  /* Glitching Text */
  #loadingScreen {
    position: fixed;
    inset: 0;
    background: var(--bg-color);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 99;
    transition: opacity 0.5s ease;
  }

  .glitch {
    font-size: 32px;
    color: var(--text-color);
    position: relative;
    text-transform: uppercase;
    animation: glitch 2s infinite;
    user-select: none;
  }

  .glitch::before,
  .glitch::after {
    content: attr(data-text);
    position: absolute;
    left: 0;
    width: 100%;
    overflow: hidden;
  }

  .glitch::before {
    left: 2px;
    text-shadow: -2px 0 red;
    clip: rect(0, 900px, 0, 0);
    animation: glitchTop 1s infinite linear alternate-reverse;
  }

  .glitch::after {
    left: -2px;
    text-shadow: -2px 0 blue;
    clip: rect(0, 900px, 0, 0);
    animation: glitchBottom 1s infinite linear alternate-reverse;
  }

  @keyframes glitch {
    2% {
      transform: translate(1px, 0);
    }
    4% {
      transform: translate(-1px, 0);
    }
    6% {
      transform: translate(1px, 1px);
    }
    8% {
      transform: translate(-1px, -1px);
    }
    10% {
      transform: translate(0, 0);
    }
  }

  @keyframes glitchTop {
    0% {
      clip: rect(0, 900px, 0, 0);
    }
    10% {
      clip: rect(0, 900px, 30px, 0);
    }
    20% {
      clip: rect(0, 900px, 0, 0);
    }
    30% {
      clip: rect(5px, 900px, 40px, 0);
    }
    100% {
      clip: rect(0, 900px, 0, 0);
    }
  }

  @keyframes glitchBottom {
    0% {
      clip: rect(0, 900px, 0, 0);
    }
    10% {
      clip: rect(20px, 900px, 60px, 0);
    }
    20% {
      clip: rect(0, 900px, 0, 0);
    }
    30% {
      clip: rect(40px, 900px, 80px, 0);
    }
    100% {
      clip: rect(0, 900px, 0, 0);
    }
  }

  /* Loader */
  .loader {
    width: 80px;
    height: 80px;
    border: 10px solid var(--btn-bg);
    border-top: 10px solid transparent;
    border-radius: 50%;
    animation: spin 1.2s linear infinite;
    margin-top: 20px;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Navigation */
  nav.nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: var(--nav-bg);
    color: var(--text-color);
    padding: 10px 20px;
  }

  nav.nav .title {
    font-weight: 700;
    font-size: 1.3rem;
  }

  nav.nav .menu-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.6rem;
    color: var(--text-color);
    user-select: none;
  }

  nav.nav .menu-items {
    position: fixed;
    top: 50px;
    right: 20px;
    background: var(--nav-bg);
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    display: none;
    flex-direction: column;
    min-width: 150px;
  }

  nav.nav .menu-items.show {
    display: flex;
  }

  nav.nav .menu-items a, nav.nav .menu-items button {
    padding: 10px 15px;
    border: none;
    background: none;
    color: var(--text-color);
    text-align: left;
    cursor: pointer;
    font-size: 1rem;
    text-decoration: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  nav.nav .menu-items a:hover, nav.nav .menu-items button:hover {
    background-color: var(--btn-bg);
    color: #fff;
  }

  nav.nav .menu-items button:last-child, nav.nav .menu-items a:last-child {
    border-bottom: none;
  }

  /* Chat container */
  .chat-container {
    max-width: 800px;
    margin: 0 auto;
    height: calc(100vh - 60px);
    display: flex;
    flex-direction: column;
  }

  .messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    background-color: var(--msg-bg);
  }

  .message {
    position: relative;
    margin: 10px 0;
    padding: 10px 15px;
    border-radius: 12px;
    background-color: var(--input-bg);
    word-wrap: break-word;
  }

  .message strong {
    display: block;
    margin-bottom: 5px;
  }

  .input-area {
    display: flex;
    padding: 10px;
    gap: 8px;
    background-color: var(--nav-bg);
    border-top: 2px solid var(--btn-bg);
  }

  input[type="text"] {
    flex: 1;
    padding: 12px 15px;
    border-radius: 10px;
    border: 1px solid var(--btn-bg);
    background-color: var(--input-bg);
    color: var(--text-color);
    font-size: 1rem;
  }

  button {
    background-color: var(--btn-bg);
    border: none;
    border-radius: 10px;
    cursor: pointer;
    color: #fff;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
  }

  button:hover {
    background-color: #0056b3;
  }
</style>
</head>
<body>
  <div id="loadingScreen">
    <div class="glitch" data-text="Stream Me.id Chatroom">Stream Me.id Chatroom</div>
    <div class="loader"></div>
  </div>

  <nav class="nav">
    <div class="title">StreamMe Chatroom</div>
    <button class="menu-btn" id="menuToggle" aria-label="Menu">☰</button>
    <div class="menu-items" id="menuItems" role="menu" aria-hidden="true">
      <a href="profile.html" role="menuitem">👤 Profile</a>
      <button id="darkModeToggle" role="menuitem">🌓 Toggle Dark/Light</button>
      <button id="logoutBtn" role="menuitem">🚪 Logout</button>
    </div>
  </nav>

  <div class="chat-container">
    <div id="messages" class="messages" aria-live="polite" aria-relevant="additions"></div>
    <div class="input-area">
      <button class="attach-btn" id="attachBtn" aria-label="Attach Image">📎</button>
      <input type="file" id="imageUpload" accept="image/*" />
      <input id="messageInput" type="text" placeholder="Type a message..." aria-label="Message input" />
      <button class="voice-btn" id="voiceBtn" aria-label="Record voice message">🎤</button>
      <button class="send-btn" id="sendBtn" aria-label="Send message">➤</button>
      <button id="emojiBtn" aria-label="Emoji Picker">😀</button>
      <div id="emojiPicker" class="emoji-picker" style="display:none;"></div>
    </div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const username = localStorage.getItem("username") || "Anonymous";

    // Redirect to login page if username is not found
    if (!username) {
      window.location.href = "login.html";
    }

    // Initialize elements
    const darkModeToggle = document.getElementById("darkModeToggle");
    const menuToggle = document.getElementById("menuToggle");
    const menuItems = document.getElementById("menuItems");
    const logoutBtn = document.getElementById("logoutBtn");
    const messageInput = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");
    const attachBtn = document.getElementById("attachBtn");
    const imageUpload = document.getElementById("imageUpload");
    const voiceBtn = document.getElementById("voiceBtn");
    const emojiBtn = document.getElementById("emojiBtn");
    const emojiPicker = document.getElementById("emojiPicker");
    const messagesDiv = document.getElementById("messages");
    const socket = io();

    // Load saved theme from localStorage
    if (localStorage.getItem("theme") === "light") {
      document.body.classList.add("light-mode");
    }

    // Toggle dark/light mode
    darkModeToggle.addEventListener("click", () => {
      document.body.classList.toggle("light-mode");
      const isLight = document.body.classList.contains("light-mode");
      localStorage.setItem("theme", isLight ? "light" : "dark");
    });

    // Toggle menu visibility
    menuToggle.addEventListener("click", () => {
      const isVisible = menuItems.classList.toggle("show");
      menuItems.setAttribute("aria-hidden", !isVisible);
    });

    // Logout functionality
    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem("username");
      window.location.href = "login.html";
    });

    // Handle socket connection
    socket.on("connect", () => {
      document.getElementById("loadingScreen").style.opacity = 0;
      setTimeout(() => (document.getElementById("loadingScreen").style.display = "none"), 500);
    });

    // Send message
    sendBtn.addEventListener("click", () => {
      const message = messageInput.value.trim();
      if (message) {
        socket.emit("message", { user: username, message });
        messageInput.value = "";
      }
    });

    // Send message on Enter key press
    messageInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        sendBtn.click();
      }
    });

    // Attach image
    attachBtn.addEventListener("click", () => imageUpload.click());
    imageUpload.addEventListener("change", () => {
      const file = imageUpload.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        socket.emit("message", {
          user: username,
          message: `<img src="${url}" style="max-width:150px; border-radius: 8px;" />`,
        });
      }
    });

    // Voice note button (placeholder)
    voiceBtn.addEventListener("click", () => {
      alert("Voice recording feature coming soon!");
    });

    // Populate emoji picker
    const emojis = ["😀", "😂", "😍", "😎", "😭", "😡", "👍", "👎", "🎉", "🔥", "❤️", "💔", "👏", "🙏", "🎶", "✨", "🚀", "🌈", "🍕", "🍔", "⚽", "🏀"];
    emojis.forEach((emoji) => {
      const span = document.createElement("span");
      span.textContent = emoji;
      span.addEventListener("click", () => {
        messageInput.value += emoji; // Add emoji to the message input
        emojiPicker.style.display = "none"; // Hide emoji picker
      });
      emojiPicker.appendChild(span);
    });

    // Toggle emoji picker visibility
    emojiBtn.addEventListener("click", () => {
      emojiPicker.style.display = emojiPicker.style.display === "block" ? "none" : "block";
    });

    // Handle incoming messages
    socket.on("message", (data) => {
      const messageElement = document.createElement("div");
      messageElement.className = "message";

      // Add AI tags or user tags
      const usernameSpan = document.createElement("strong");
      usernameSpan.textContent = data.user;

      // Add AI tag if the message is from an AI user
      if (data.user.toLowerCase() === "ai") {
        const aiTag = document.createElement("span");
        aiTag.textContent = " 🤖 AI";
        aiTag.style.color = "#0288d1";
        aiTag.style.fontWeight = "bold";
        aiTag.style.marginLeft = "8px";
        usernameSpan.appendChild(aiTag);
      }

      // Add AI Command tag if the message starts with ".ai"
      if (data.message.trim().toLowerCase().startsWith(".ai")) {
        const aiCmdTag = document.createElement("span");
        aiCmdTag.textContent = " 🧠 AI Command";
        aiCmdTag.style.color = "#f57c00";
        aiCmdTag.style.fontWeight = "bold";
        aiCmdTag.style.marginLeft = "8px";
        usernameSpan.appendChild(aiCmdTag);
      }

      // Append message content
      const content = document.createElement("div");
      content.innerHTML = `${data.message || ""}`;
      messageElement.appendChild(usernameSpan);
      messageElement.appendChild(content);

      // Add reactions
      const reactionsDiv = document.createElement("div");
      reactionsDiv.className = "reactions";
      const reactionEmojis = ["👍", "😂", "❤️", "🔥"];
      reactionEmojis.forEach((emoji) => {
        const reactionBtn = document.createElement("button");
        reactionBtn.textContent = emoji;
        reactionBtn.title = `React with ${emoji}`;
        reactionBtn.addEventListener("click", () => {
          const reactionSpan = document.createElement("span");
          reactionSpan.textContent = emoji;
          reactionSpan.style.marginLeft = "6px";
          messageElement.appendChild(reactionSpan);
        });
        reactionsDiv.appendChild(reactionBtn);
      });

      // Add reply button
      const replyBtn = document.createElement("button");
      replyBtn.textContent = "💬";
      replyBtn.title = "Reply to this message";
      replyBtn.addEventListener("click", () => {
        messageInput.placeholder = `Replying to: ${data.message}`;
        messageInput.focus();
      });
      reactionsDiv.appendChild(replyBtn);

      messageElement.appendChild(reactionsDiv);
      messagesDiv.appendChild(messageElement);

      // Scroll to the latest message
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
  });
</script>
</body>
</html>